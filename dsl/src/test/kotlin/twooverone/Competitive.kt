package twooverone

import com.github.phisgr.bridge.BiddingSystem
import com.github.phisgr.bridge.Bidder.*

/**
 * 競叫系統 (Competitive Bidding)
 * 防守叫牌、蓋叫、競叫處理
 */

/**
 * 將競叫規則添加到系統說明
 */
fun BiddingSystem.addCompetitiveBidding() {
    description += """

## 防守叫牌

### 蓋叫
- 簡單蓋叫：7-17點，5+張好牌組
- 跳蓋叫：阻擊性，6-7張牌組
- 1NT蓋叫：15-18點平均牌型，有開叫花色止張
- Unusual 2NT：5-5+兩個最低未叫花色
- Michaels 扣叫：5-4+未叫花色

### 蓋叫後的應叫
- 簡單加叫：6-10點，3+張支持
- 跳加叫：4-8點，4+張支持，阻擊性
- 扣叫：11+點，迫叫
- 新花色：10+點，5+張牌組

### 負賭倍
- 同伴開叫對方蓋叫後使用
- 表示未叫高花4+張，7-11點典型
- 牌力無上限

### 支持性賭倍
- 同伴開叫，你應叫，對方叫牌
- 賭倍＝3張支持
- 直接加叫＝4+張支持

### Lebensohl
- 同伴1NT被賭倍或蓋叫後
- 2NT接力＝弱牌，要求叫3C
- 直接三副＝邀叫+
"""

    // 對1C開叫的防守
    opponentOpen("1C") {
        "X" - "技術性賭倍：未叫花色支持或16+點" {
            opponent("XX") {
                "Pass" - "有牌力，之後賭倍為懲罰性"
            }
            opponent("1D") {
                "X" - "技術性賭倍，雙高花"
            }
            "1D" - "自然叫，4+D"
            "1H" - "自然叫，4+H"
            "1S" - "自然叫，4+S"
            "1N" - "7-10點，均衡，有C止張"
            "2N" - "11-12點邀叫"
        }
        "1D" - "自然蓋叫，5+D，7-17點" {
            opponent("X") {
                "XX" - "有牌力"
                "2D" - "弱加叫"
            }
            "1N" - "6-10點，均衡"
            "2D" - "簡單加叫，6-10點"
            "3D" - "阻擊性加叫"
        }
        "1H" - "自然蓋叫，5+H，7-17點" {
            opponent("X") {
                "XX" - "有牌力，9+點"
                "2H" - "弱加叫"
                "3H" - "阻擊性"
            }
            "1S" - "自然叫，5+S"
            "1N" - "6-10點，均衡"
            "2H" - "簡單加叫"
            "2N" - "有限加叫，11-12點"
            "3H" - "阻擊性"
        }
        "1S" - "自然蓋叫，5+S，7-17點" {
            opponent("X") {
                "XX" - "有牌力"
                "2S" - "弱加叫"
                "3S" - "阻擊性"
            }
            "1N" - "6-10點，均衡"
            "2S" - "簡單加叫"
            "2N" - "有限加叫"
            "3S" - "阻擊性"
        }
        "1N" - "15-18點平均牌型，有C止張" {
            "2C" - "Stayman"
            "2D" - "轉移叫到H"
            "2H" - "轉移叫到S"
            "2S" - "Minor Suit Stayman"
            "2N" - "邀叫"
            "3N" - "止叫"
        }
        "2C" - "自然叫，6+C，10-16點"
        "2D" - "Michaels：雙高花，5-4+" {
            "2H" - "選擇H"
            "2S" - "選擇S"
            "2N" - "問較長高花或牌力"
            "3H" - "邀叫，H"
            "3S" - "邀叫，S"
        }
        "2H" - "阻擊性跳蓋叫，6張H"
        "2S" - "阻擊性跳蓋叫，6張S"
        "2N" - "Unusual：5+D-5+H" {
            "3D" - "選擇D"
            "3H" - "選擇H"
        }
        "3C" - "阻擊性，7+C"
        "3D" - "阻擊性，7+D"
    }

    // 對1D開叫的防守
    opponentOpen("1D") {
        "X" - "技術性賭倍：未叫花色支持或16+點" {
            opponent("XX") {
                "Pass" - "有牌力"
            }
            "1H" - "自然叫，4+H"
            "1S" - "自然叫，4+S"
            "1N" - "7-10點，有D止張"
            "2H" - "跳叫＝好的5+H，9-11點"
            "2S" - "跳叫＝好的5+S，9-11點"
            "2N" - "11-12點邀叫"
        }
        "1H" - "自然蓋叫，5+H" {
            opponent("X") {
                "XX" - "有牌力"
                "2H" - "弱"
            }
            "2H" - "簡單加叫"
            "2N" - "有限加叫"
            "3H" - "阻擊性"
        }
        "1S" - "自然蓋叫，5+S" {
            opponent("X") {
                "XX" - "有牌力"
                "2S" - "弱"
            }
            "2S" - "簡單加叫"
            "2N" - "有限加叫"
            "3S" - "阻擊性"
        }
        "1N" - "15-18點平均牌型，有D止張" {
            "2C" - "Stayman"
            "2D" - "轉移叫到H"
            "2H" - "轉移叫到S"
        }
        "2C" - "自然叫，5+C" {
            "2D" - "自然叫，5+D"
            "2N" - "邀叫"
        }
        "2D" - "Michaels：雙高花，5-4+" {
            "2H" - "選擇H"
            "2S" - "選擇S"
            "2N" - "詢問"
        }
        "2N" - "Unusual：5+C-5+H" {
            "3C" - "選擇C"
            "3H" - "選擇H"
        }
    }

    // 對1H開叫的防守
    opponentOpen("1H") {
        "X" - "技術性賭倍：4+S+低花支持或16+點" {
            opponent("XX") {
                "Pass" - "有牌力，傾向懲罰"
                "1S" - "自然叫，4+S"
            }
            opponent("2H") {
                "X" - "響應性賭倍，有牌力無明確方向"
                "2S" - "自然叫"
            }
            "1S" - "自然叫，4+S"
            "1N" - "7-10點，有H止張"
            "2C" - "自然叫，5+C"
            "2D" - "自然叫，5+D"
            "2S" - "跳叫＝9-11點，5+S"
            "2N" - "11-12點邀叫"
        }
        "1S" - "自然蓋叫，5+S" {
            opponent("X") {
                "XX" - "有牌力，9+點"
                "2S" - "弱加叫"
                "2N" - "有限加叫，4+S"
                "3S" - "阻擊性"
            }
            opponent("2H") {
                "2S" - "競叫性"
                "2N" - "有限加叫"
                "3S" - "阻擊性"
            }
            "2C" - "自然叫，建設性"
            "2D" - "自然叫，建設性"
            "2S" - "簡單加叫"
            "2N" - "有限加叫"
            "3S" - "阻擊性"
        }
        "1N" - "15-18點平均牌型，有H止張" {
            opponent("X") {
                "XX" - "有牌力"
                "2C" - "Stayman"
                "2D" - "轉移叫"
            }
            "2C" - "Stayman"
            "2D" - "轉移叫到H（問止張）"
            "2H" - "轉移叫到S"
        }
        "2C" - "自然叫，5+C" {
            "2D" - "自然叫"
            "2H" - "扣叫，C加叫或迫叫進局"
            "2S" - "自然叫，4+S"
            "2N" - "自然邀叫"
        }
        "2D" - "自然叫，5+D" {
            "2H" - "扣叫，D加叫或迫叫進局"
            "2N" - "邀叫"
        }
        "2H" - "Michaels：S+低花，5-4+" {
            "2S" - "選擇S"
            "2N" - "問低花" {
                "3C" - "C"
                "3D" - "D"
            }
            "3S" - "邀叫"
            "4S" - "止叫"
        }
        "2S" - "阻擊性跳蓋叫"
        "2N" - "Unusual：5+C-5+D" {
            "3C" - "選擇C"
            "3D" - "選擇D"
        }
        "3C" - "阻擊性"
        "3D" - "阻擊性"
    }

    // 對1S開叫的防守
    opponentOpen("1S") {
        "X" - "技術性賭倍：未叫花色支持或16+點" {
            opponent("XX") {
                "Pass" - "有牌力"
            }
            opponent("2S") {
                "X" - "響應性賭倍"
                "3H" - "自然叫"
            }
            "1N" - "7-10點，有S止張"
            "2C" - "自然叫"
            "2D" - "自然叫"
            "2H" - "自然叫"
            "2N" - "11-12點邀叫"
            "3H" - "跳叫＝好牌組"
        }
        "1N" - "15-18點平均牌型，有S止張" {
            "2C" - "Stayman"
            "2D" - "轉移叫到H"
            "2H" - "轉移叫到S（問止張）"
        }
        "2C" - "自然叫，5+C" {
            "2D" - "自然叫"
            "2H" - "自然叫，5+H"
            "2S" - "扣叫，C加叫或迫叫進局"
            "2N" - "邀叫"
        }
        "2D" - "自然叫，5+D" {
            "2H" - "自然叫"
            "2S" - "扣叫"
        }
        "2H" - "自然蓋叫，5+H" {
            opponent("X") {
                "XX" - "有牌力"
                "2S" - "扣叫，加叫"
                "3H" - "阻擊性"
            }
            opponent("2S") {
                "3H" - "競叫性"
                "4H" - "止叫"
            }
            "2S" - "扣叫，有限+加叫"
            "3H" - "阻擊性"
            "2N" - "有限加叫"
            "4H" - "止叫"
        }
        "2S" - "Michaels：H+低花，5-4+" {
            "2N" - "問低花" {
                "3C" - "C"
                "3D" - "D"
            }
            "3H" - "選擇H"
            "4H" - "止叫"
        }
        "2N" - "Unusual：5+C-5+D" {
            "3C" - "選擇C"
            "3D" - "選擇D"
        }
        "3H" - "阻擊性"
    }

    // 對強1NT開叫的防守
    opponentOpen("1N", "強15-17") {
        "X" - "懲罰性，15+點" {
            opponent("XX") {
                "Pass" - "願意防守"
                "2C" - "逃叫，C或D"
                "2D" - "逃叫，H"
                "2H" - "逃叫，S"
            }
            "Pass" - "等待"
            "2C" - "止叫，弱牌"
        }
        "2C" - "DONT：單花色或C+較高花色" {
            "2D" - "不叫或改叫"
            "2H" - "止叫"
            "2S" - "止叫"
        }
        "2D" - "單高花或雙高花" {
            "2H" - "不叫或改叫"
            "2S" - "不叫或改叫"
            "2N" - "詢問，邀叫+"
        }
        "2H" - "H+低花，5-4+" {
            "2S" - "若為H則止叫"
            "2N" - "問低花"
        }
        "2S" - "S+低花，5-4+" {
            "2N" - "問低花"
        }
        "2N" - "雙低花，5-5+"
        "3C" - "阻擊性"
        "3D" - "阻擊性"
        "3H" - "阻擊性"
        "3S" - "阻擊性"
    }

    // 對弱二開叫的防守
    opponentOpen("2H", "弱二") {
        "X" - "技術性賭倍，13+點或好牌型" {
            "2S" - "0-8點，4+S"
            "2N" - "Lebensohl 接力" {
                "3C" - "迫叫接力" {
                    "Pass" - "C弱牌"
                    "3D" - "D弱牌"
                    "3H" - "Stayman 有止張"
                    "3S" - "S邀叫"
                    "3N" - "止叫有止張"
                }
            }
            "3C" - "自然叫，邀叫"
            "3D" - "自然叫，邀叫"
            "3S" - "自然叫，邀叫"
            "3H" - "Stayman 無止張"
            "3N" - "止叫無止張"
        }
        "2S" - "自然叫，5+S" {
            "2N" - "有限加叫"
            "3S" - "阻擊性"
            "4S" - "止叫"
        }
        "2N" - "15-18點，有H止張" {
            "3C" - "Puppet Stayman"
            "3D" - "轉移叫"
        }
        "3C" - "自然叫"
        "3D" - "自然叫"
        "3H" - "Michaels：S+低花"
        "4C" - "S+C"
        "4D" - "S+D"
    }

    // 對弱二S開叫的防守
    opponentOpen("2S", "弱二") {
        "X" - "技術性賭倍，13+點或好牌型" {
            "2N" - "Lebensohl 接力" {
                "3C" - "迫叫接力" {
                    "Pass" - "C弱牌"
                    "3D" - "D弱牌"
                    "3H" - "H弱牌"
                    "3S" - "Stayman 有止張"
                    "3N" - "止叫有止張"
                }
            }
            "3C" - "自然叫，邀叫"
            "3D" - "自然叫，邀叫"
            "3H" - "自然叫，邀叫"
            "3S" - "Stayman 無止張"
            "3N" - "止叫無止張"
        }
        "2N" - "15-18點，有S止張" {
            "3C" - "Puppet Stayman"
            "3D" - "轉移叫"
            "3H" - "轉移叫"
        }
        "3C" - "自然叫"
        "3D" - "自然叫"
        "3H" - "自然叫，5+H" {
            "3S" - "扣叫，加叫"
            "4H" - "止叫"
        }
        "3S" - "Michaels：H+低花"
        "4C" - "H+C"
        "4D" - "H+D"
    }

    // 平衡位置
    "平衡位置" - "" {
        explanation = """平衡位置叫牌比直接位置輕。
            |從正常要求減去2-3點。
            |同伴不應因平衡叫牌而懲罰你。""".trimMargin()
    }
}
