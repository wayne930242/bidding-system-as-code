package twooverone

import com.github.phisgr.bridge.BiddingTree

/**
 * 1NT 開叫及應叫
 * 16-18 HCP 均衡型
 */
fun BiddingTree.oneNoTrump() {
    explanation = "16-18 HCP均衡型，無單張和缺門"

    // Stayman
    "2C" - "司臺曼：問4張高花，7+點；或7-8點接力邀叫2NT" {
        stayman()
    }

    // Jacoby Transfer
    "2D" - "傑考培轉移叫：5+H，或單牌組滿貫試探" {
        jacobyToHearts()
    }

    "2H" - "傑考培轉移叫：5+S" {
        jacobyToSpades()
    }

    // Minor Suit Stayman
    "2S" - "低花司臺曼：問4張低花，或D長牌組弱牌，或5-4+雙低花滿貫意圖" {
        minorSuitStayman()
    }

    // 2NT Transfer to 3C
    "2N" - "轉移叫：C長牌組弱牌，或三花色牌組好牌(4-4-4-1/5-4-4-0)滿貫意圖" {
        "3C" - "接受轉移" {
            "Pass" - "C長牌組弱牌示弱"
            "3D" - "短牌組D，4-4-4-1或5-4-4-0滿貫試探"
            "3H" - "短牌組H，4-4-4-1或5-4-4-0滿貫試探"
            "3S" - "短牌組S，4-4-4-1或5-4-4-0滿貫試探"
        }
    }

    // Jump suit responses
    "3C" - "6-7張不連張C牌組，邀叫3NT"
    "3D" - "6-7張不連張D牌組，邀叫3NT"
    "3H" - "6-7張不連張H牌組，邀叫滿貫"
    "3S" - "6-7張不連張S牌組，邀叫滿貫"

    // Gerber
    "4C" - "葛伯問A" {
        gerber()
    }

    // Texas Transfer
    "4D" - "德克薩斯轉移叫：6+H" {
        "4H" - "接受轉移" {
            "Pass" - "止叫"
            "4N" - "RKC黑木問叫，H為將牌"
        }
    }

    "4H" - "德克薩斯轉移叫：6+S" {
        "4S" - "接受轉移" {
            "Pass" - "止叫"
            "4N" - "RKC黑木問叫，S為將牌"
        }
    }

    "4N" - "15-16點，均衡型，滿貫定量邀請"

    // Direct game bids
    "3N" - "9-14點，均衡型，止叫"

    // Interference
    overcall("X", "懲罰性") {
        lebensohl()
    }

    overcall("2any") {
        lebensohl()
    }
}

/**
 * 司臺曼叫牌
 */
private fun BiddingTree.stayman() {
    "2D" - "無4張高花" {
        "2H" - "接力叫2S，可能5+S-4+H弱牌或迫叫進局牌" {
            "2S" - "接受接力" {
                "Pass" - "5+S-4+H弱牌"
                "2N" - "邀叫牌力"
                "3N" - "進局牌力"
            }
        }
        "2S" - "接力叫，17+均衡或迫叫進局" {
            "2N" - "低限" {
                "3S" - "5S-4H-2D-2C 15點"
            }
        }
        "2N" - "7-8點邀叫，可有可無4張高花"
        "3C" - "自然叫迫叫進局"
        "3D" - "自然叫迫叫進局"
        "3H" - "5-5雙高花邀叫"
        "3S" - "5-5雙高花成局"
        "3N" - "9-14點，保證有4張高花"
        "4N" - "15-16點，滿貫邀叫"
    }

    "2H" - "4+H，可能還有4S" {
        "2S" - "4S邀叫牌力" {
            "2N" - "低限，無4S"
            "3S" - "高限，4S"
            "4S" - "有4S，接受邀叫"
        }
        "2N" - "無4張高花，邀叫（需提醒）"
        "3H" - "邀叫"
        "3N" - "保證4S成局牌力，開叫者若有雙高花可改叫4S"
        "3S" - "發現H配合，有單缺張，滿貫意圖" {
            "3N" - "問單缺張" {
                "4C" - "C短牌組"
                "4D" - "D短牌組"
                "4H" - "S短牌組"
            }
        }
        "4C" - "RKC葛伯問叫，H為將牌"
        "4D" - "發現H配合，無單缺張，15-16點滿貫意圖"
        "4H" - "止叫"
    }

    "2S" - "4+S，無4H" {
        "2N" - "邀叫"
        "3H" - "發現S配合，有單缺張，滿貫意圖" {
            "3S" - "問單缺張" {
                "3N" - "C短牌組"
                "4C" - "D短牌組"
                "4D" - "H短牌組"
            }
        }
        "3S" - "邀叫"
        "4C" - "RKC葛伯問叫，S為將牌"
        "4D" - "發現S配合，無單缺張，15-16點滿貫意圖"
        "4S" - "止叫"
        "3N" - "無4S，止叫"
    }
}

/**
 * 傑考培轉移叫到H
 * 可能是5+H，或單牌組滿貫試探(瓦魯許接力叫)
 */
private fun BiddingTree.jacobyToHearts() {
    "2H" - "接受轉移" {
        "Pass" - "弱牌，由開叫者打"
        "2S" - "單牌組滿貫試探，要求開叫者接力叫2NT" {
            "2N" - "接力" {
                warushiRelay()
            }
        }
        "2N" - "5張牌組均衡型，邀叫"
        "3C" - "另有4+C，滿貫試探"
        "3D" - "另有4+D，滿貫試探"
        "3H" - "邀叫"
        "3S" - "5+S-5+H滿貫試探"
        "3N" - "5張牌組均衡型，選擇止叫"
        "4C" - "5+H-5+C滿貫試探"
        "4D" - "5+H-5+D滿貫試探"
        "4H" - "止叫（有一點滿貫意圖，否則用德克薩斯）"
        "4N" - "表示牌力（非黑木），堅實5張H牌組"
    }

    // 開叫者超級接受
    "3H" - "4張H支持，高限，超級接受" {
        "4H" - "止叫"
    }

    "3C" - "3張H支持，C牌組實力集中，邀叫進局"
    "3D" - "3張H支持，D牌組實力集中，邀叫進局"
}

/**
 * 傑考培轉移叫到S
 */
private fun BiddingTree.jacobyToSpades() {
    "2S" - "接受轉移" {
        "Pass" - "弱牌"
        "2N" - "5張牌組均衡型，邀叫"
        "3C" - "4S-5+C邀叫"
        "3D" - "4S-5+D邀叫"
        "3H" - "4S-5+H邀叫"
        "3S" - "邀叫"
        "3N" - "5張牌組均衡型，選擇止叫"
        "4C" - "5+S-5+C滿貫試探"
        "4D" - "5+S-5+D滿貫試探"
        "4H" - "5+S-5+H選擇止叫"
        "4S" - "止叫"
        "4N" - "表示牌力（非黑木），堅實5張S牌組"
    }

    // 開叫者超級接受
    "3S" - "4張S支持，高限，超級接受" {
        "4S" - "止叫"
    }

    "3C" - "3張S支持，C牌組實力集中，邀叫進局"
    "3D" - "3張S支持，D牌組實力集中，邀叫進局"
}

/**
 * 低花司臺曼
 */
private fun BiddingTree.minorSuitStayman() {
    "2N" - "無4張低花" {
        "Pass" - "邀叫無將"
        "3C" - "雙低花弱牌，開叫者可不叫或改叫3D"
        "3D" - "D長牌組弱牌"
    }

    "3C" - "4+C" {
        "Pass" - "C長牌組弱牌或雙低花弱牌"
        "3D" - "D長牌組弱牌"
        "3N" - "5-4雙低花，略有滿貫意圖"
        "4C" - "RKC問叫，C為將牌"
        "4N" - "5-4雙低花，強烈滿貫意圖"
    }

    "3D" - "4+D" {
        "Pass" - "D長牌組弱牌"
        "3N" - "5-4雙低花，略有滿貫意圖"
        "4D" - "RKC問叫，D為將牌"
        "4N" - "5-4雙低花，強烈滿貫意圖"
    }
}

/**
 * 瓦魯許接力叫（單牌組滿貫試探）
 */
private fun BiddingTree.warushiRelay() {
    "3C" - "不連張C牌組"
    "3D" - "不連張D牌組"
    "3H" - "堅實（或接近堅實）C牌組"
    "3S" - "堅實（或接近堅實）D牌組"
    "4C" - "6+張H牌組，旁門無A或K"
    "4D" - "6+張S牌組，旁門無A或K"
    "4H" - "7張H牌組，旁門無A或K"
    "4S" - "7張S牌組，旁門無A或K"
}

/**
 * 葛伯問A
 */
private fun BiddingTree.gerber() {
    "4D" - "0或3個A"
    "4H" - "1或4個A"
    "4S" - "2個A，低限"
    "4N" - "2個A，有額外實力願意滿貫"
}

/**
 * 萊朋梭爾約定叫（干擾後使用）
 */
private fun BiddingTree.lebensohl() {
    remark(responder, "2NT為接力叫，要求開叫者叫3C")
    remark(responder, "立即跳叫3NT表示無爭叫花色止張")
    remark(responder, "立即扣叫為司臺曼，無爭叫花色止張")
    remark(responder, "經2NT接力後再叫3NT表示有爭叫花色止張")
    remark(responder, "經2NT接力後再扣叫為司臺曼，有爭叫花色止張")
}
