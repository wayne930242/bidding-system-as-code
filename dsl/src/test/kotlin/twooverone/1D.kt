package twooverone

import com.github.phisgr.bridge.BiddingTree

/**
 * 1D 開叫及應叫
 * D至少4張（除非4-4-3-2），12-21 HCP
 */
fun BiddingTree.oneDiamond() {
    explanation = "D至少4張（4-4-3-2時3張D開叫），12-21點"

    // 一副高花應叫
    "1H" - "4+H，5+點" {
        oneMajorResponseAfterDiamond()
    }

    "1S" - "4+S，5+點" {
        oneMajorResponseAfterDiamond()
    }

    // 無將應叫
    "1N" - "5-9點，均衡型，無4張高花"
    "2N" - "9-12點，均衡型，無4張高花，邀叫"
    "3N" - "12-15點，均衡型，無4張高花"

    // 反常低花加叫
    "2D" - "反常加叫：9+點，4+D支持，迫叫一輪，無4張高花" {
        invertedDiamondRaise()
    }

    "3D" - "阻擊性加叫：5-9點，4+D支持，無4張高花" {
        "Pass" - "低限"
        "3N" - "19-20點均衡型"
    }

    // 二蓋一應叫（進局迫叫）
    "2C" - "二蓋一：4+C，12+點，迫叫進局" {
        twoClubAfterOneDiamond()
    }

    // 邀叫性跳應叫
    "3C" - "邀叫：好的6張C排組，9-12點"

    // 阻擊性跳叫新花色
    "2H" - "阻擊：6張H排組，3-6點"
    "2S" - "阻擊：6張S排組，3-6點"
    "3H" - "阻擊：7張H排組"
    "3S" - "阻擊：7張S排組"
}

/**
 * 低花開叫後一副高花應叫的開叫者再叫
 */
private fun BiddingTree.oneMajorResponseAfterDiamond() {
    "1S" - "4+S（如應叫為1H）"
    "1N" - "12-15點均衡型，無4張應叫花色支持"

    "2C" - "4+C，可能5D-4C或更長" {
        "2D" - "第四花色排組迫叫"
    }

    "2D" - "6+D，12-15點" {
        "2N" - "邀叫"
        "3D" - "邀叫"
    }

    // 簡單加叫（低限）
    "2H" - "4張H支持，12-15點（如應叫為1H）"
    "2S" - "4張S支持，12-15點（如應叫為1S）"

    "2N" - "19-20點均衡型，無4張應叫花色支持"

    // 跳加叫（邀叫性非均衡型）
    "3H" - "4張H支持，非均衡型，15-18點（如應叫為1H）"
    "3S" - "4張S支持，非均衡型，15-18點（如應叫為1S）"

    // 蹦跳叫牌
    // 1D-1S-3H = 跳倒叫，4S支持，H短排組，19+點
    "3C" - "蹦跳叫牌（二級跳）：4張應叫花色支持，C短排組，19+點"

    // 直接進局（高限均衡型）
    "4H" - "4張H支持，均衡型，19+點（如應叫為1H）"
    "4S" - "4張S支持，均衡型，19+點（如應叫為1S）"

    "3N" - "16-18點，6-7張接近堅實D排組"

    // 瓦魯許割裂叫牌
    "4C" - "瓦魯許割裂：6+D，4張應叫花色支持，成局力量無滿貫意圖"
    "4D" - "瓦魯許割裂：6+D，4張應叫花色支持，滿貫意圖"
}

/**
 * 反常D加叫後的開叫者再叫
 */
private fun BiddingTree.invertedDiamondRaise() {
    "2H" - "顯示H止張，12-13點" {
        "2S" - "顯示S止張"
        "2N" - "低限，不迫叫"
        "3C" - "顯示C止張"
        "3D" - "低限，不迫叫"
        "3N" - "接受邀叫"
    }

    "2S" - "顯示S止張，12-13點"
    "3C" - "顯示C止張，12-13點"

    "2N" - "14-15點均衡型，兩高花有止張" {
        "3D" - "低限，長排組D"
        "3N" - "接受邀叫"
    }

    "3D" - "低限非均衡型，阻擊性再加叫"

    // 滿貫試探
    "3H" - "跳叫新花色：H短排組，滿貫意圖"
    "3S" - "跳叫新花色：S短排組，滿貫意圖"
    "4C" - "跳叫新花色：C短排組，滿貫意圖"
    "4D" - "RKC問叫（費爾德曼），D為將牌"
    "3N" - "19-20點均衡型"
}

/**
 * 1D-2C後的開叫者再叫（二蓋一進局迫叫）
 */
private fun BiddingTree.twoClubAfterOneDiamond() {
    "2D" - "5+D"
    "2H" - "4+H（形同倒叫但不需額外牌力）"
    "2S" - "4+S（形同倒叫但不需額外牌力）"
    "2N" - "12-14點均衡型，無5+D"
    "3C" - "3+C支持帶大牌，14-15點"
    "3D" - "好的6+D"
    "3H" - "蹦跳叫牌：C支持，H短排組"
    "3S" - "蹦跳叫牌：C支持，S短排組"
    "3N" - "16-18點，6-7張接近堅實D排組"
}
